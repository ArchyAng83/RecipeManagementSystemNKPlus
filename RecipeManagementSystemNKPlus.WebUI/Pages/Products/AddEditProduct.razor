@page "/product/add"
@page "/product/edit/{id:int}"

<h3>Product</h3>

<div class="row g-3 align-items-center">
    <EditForm Model="_product" OnValidSubmit="SaveProductAsync">
        <div class="form-group row">
            <div class="col-2">
                <label for="name" class="col-auto col-form-label">
                    Product Name:
                </label>
            </div>
            <div class="col-4">
                <div class="col-lg-auto mb-3">
                    <InputText id="name" class="form-control" @bind-Value="_product!.Name" />
                    <ValidationMessage For="() => _product.Name" />
                </div>
            </div>            
        </div>
        <div class="form-group row">
            <div class="col-2">
                <label for="quantity" class="col-auto col-form-label">
                    Quntity:
                </label>
            </div>
            <div class="col-4">
                <div class="col-lg-auto mb-3">
                    <InputNumber id="quantity" class="form-control" @bind-Value="_product.Quantity" />
                    <ValidationMessage For="() => _product.Quantity" />
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-2">
                <label for="weight" class="col-auto col-form-label">
                    Ingredient Name:
                </label>
            </div>
            <div class="col-4">
                <div class="col-lg-auto mb-3">
                    <InputNumber id="weight" class="form-control" @bind-Value="_product.Weight" />
                    <ValidationMessage For="() => _product.Weight" />
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-2">
                <label for="description" class="col-auto col-form-label">
                    Ingredient Name:
                </label>
            </div>
            <div class="col-4">
                <div class="col-lg-auto mb-3">
                    <InputTextArea id="description" class="form-control" @bind-Value="_product.Description" />
                    <ValidationMessage For="() => _product.Weight" />
                </div>
            </div>
        </div>
    </EditForm>
    <div class="col-auto">
        <button class="btn btn-success" type="submit">
            <i class="bi bi-check2"></i>
            Save
        </button>
    </div>
    <div>
        @foreach (var comp in _product!.CompositeTypes!)
        {
            <p>@comp.Name</p>
            <ul>
                @foreach (var ing in comp.Ingredients!)
                {
                    <li>@ing.Name</li>
                }
            </ul>
           
        }
    </div>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private Product? _product = new();

    protected override async Task OnInitializedAsync()
    {        
        if (Id != 0)
        {
            _product = await ProductService.GetByIdAsync(Constant.ProductBaseUrl, Id);
        }        
    }

    private async Task SaveProductAsync()
    {
        if (Id <= 0)
        {
            await ProductService.AddAsync(Constant.ProductBaseUrl, _product!);
        }
        else
        {
            await ProductService.UpdateAsync(Constant.ProductBaseUrl, _product!);
        }

        NavManager.NavigateTo("/products");
    }

}
